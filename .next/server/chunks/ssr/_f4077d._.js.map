{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/src/lib/actions.js"],"sourcesContent":["'use server'\nimport bcrypt from 'bcryptjs'\nimport  prisma  from '@/lib/prisma'\nimport { signIn, signOut } from '@/auth';\nimport { getUserByEmail } from '@/lib/data';\nimport { revalidatePath } from 'next/cache'\n\n\n// REGISTER\nexport async function register(prevState, formData) {\n    const name = formData.get('name')\n    const email = formData.get('email')\n    const password = formData.get('password')\n\n    // Comprobamos si el usuario ya está registrado\n    const user = await getUserByEmail(email);\n\n    if (user) {\n        return {\n            error: 'El email ya está registrado',\n            fields: Object.fromEntries(formData.entries())\n        }\n    }\n\n    // Encriptamos password \n    const hashedPassword = await bcrypt.hash(password, 10)\n\n    // Guardamos credenciales en base datos\n    await prisma.user.create({\n        data: {\n            name,\n            email,\n            password: hashedPassword\n        }\n    })\n\n    return { success: \"Registro correcto\" }\n}\n\n\n\n// LOGIN credentials\nexport async function login(prevState, formData) {\n    const email = formData.get('email')\n    const password = formData.get('password')\n\n    // Comprobamos si el usuario está registrado\n    const user = await getUserByEmail(email);\n\n    if (!user) {\n        return {\n            error: 'Usuario no registrado.',\n            fields: Object.fromEntries(formData.entries())\n        }\n    }\n\n    // Comparamos password \n    const matchPassword = await bcrypt.compare(password, user.password)\n\n    if (user && matchPassword) {  // && user.emailVerified\n        await signIn('credentials',\n            {\n                email, password,\n                redirectTo: globalThis.callbackUrl\n            })\n        return { success: \"Inicio de sesión correcto\" }\n    } else {\n        return {\n            error: 'Credenciales incorrectas.',\n            fields: Object.fromEntries(formData.entries())\n        }\n    }\n\n}\n\n// LOGIN google\nexport async function loginGoogle() {\n    try {\n        await signIn('google', { redirectTo: globalThis.callbackUrl })\n    } catch (error) {\n        console.log(error);\n        throw error\n    }\n}\n\n// LOGIN github\nexport async function loginGithub() {\n    try {\n        await signIn('github', { redirectTo: globalThis.callbackUrl })\n    } catch (error) {\n        console.log(error);\n        throw error\n    }\n}\n\n\n// LOGIN discord\nexport async function loginDiscord() {\n    try {\n        await signIn('discord', { redirectTo: globalThis.callbackUrl })\n    } catch (error) {\n        console.log(error);\n        throw error\n    }\n}\n\n\n// LOGIN resend (Magic Link to email)\nexport async function loginResend(formData) {\n    try {\n        await signIn(\"resend\", formData)\n    } catch (error) {\n        console.log(error);\n        throw error\n    }\n}\n\n\n\n// LOGOUT\nexport async function logout() {\n    try {\n        await signOut({ redirectTo: '/' })\n    } catch (error) {\n        throw error\n    }\n}\n\nexport async function insertarRepartidor(formData) {\n    const nombre = formData.get('nombre')\n    const telefono = formData.get('telefono')\n    const imagen = formData.get('imagen') || null\n\n    await prisma.repartidor.create({\n        data: {\n            nombre: nombre,\n            telefono: telefono,\n            imagen: imagen\n        }\n    })\n\n    revalidatePath('/repartidores')\n\n}\n\n\nexport async function modificarRepartidor(formData) {\n    const id = Number(formData.get('id'))\n    const nombre = formData.get('nombre')\n    const telefono = formData.get('telefono')\n    const imagen = formData.get('imagen')\n\n\n    await prisma.repartidor.update({\n        where: {\n            id: id\n        },\n        data: {\n            nombre: nombre,\n            telefono: telefono,\n            imagen: imagen\n        }\n    })\n\n    revalidatePath('/repartidores')\n}\n\n\n\nexport async function eliminarRepartidor(formData) {\n    const id = Number(formData.get('id'))\n\n    await prisma.repartidor.delete({\n        where: {\n            id: id\n        }\n    })\n\n    revalidatePath('/repartidores')\n\n}\n\n\n//  ------------------------ PEDIDOS ------------------------\n\n\nexport async function insertarPedido(prevState, formData) {\n    const fecha_hora = new Date(formData.get('fecha_hora'))\n    const nombre_cliente = formData.get('nombre_cliente')\n    const direccion_cliente = formData.get('direccion_cliente')\n\n    const repartidorId = Number(formData.get('repartidorId')) || null\n\n    const pizzasIDs = await prisma.pizza.findMany({\n        select: { id: true }\n    })\n\n    const connect = pizzasIDs.filter(p => formData.get(`pizza${p.id}`) !== null)\n \n\n    await prisma.pedido.create({\n        data: {\n            fecha_hora: fecha_hora,\n            nombre_cliente: nombre_cliente,\n            direccion_cliente: direccion_cliente,\n            repartidorId: repartidorId,\n            pizzas: { connect }\n        }\n    })\n\n    revalidatePath('/pedidos')\n    return { success: 'Operación realizada correctamente' }\n\n}\n\n\n\nexport async function modificarPedido(prevState, formData) {\n    const id = Number(formData.get('id'))\n    const fecha_hora = new Date(formData.get('fecha_hora'))\n    const nombre_cliente = formData.get('nombre_cliente')\n    const direccion_cliente = formData.get('direccion_cliente')\n\n    const repartidorId = Number(formData.get('repartidorId')) || null\n\n    const pizzasIDs = await prisma.pizza.findMany({\n        select: { id: true }\n    })\n    // console.log(pizzasIDs);\n    const connect = pizzasIDs.filter(p => formData.get(`pizza${p.id}`) !== null)\n    const disconnect = pizzasIDs.filter(p => formData.get(`pizza${p.id}`) === null)\n    // console.log(connect);\n\n    await prisma.pedido.update({\n        where: {\n            id: id\n        },\n        data: {\n            fecha_hora: fecha_hora,\n            nombre_cliente: nombre_cliente,\n            direccion_cliente: direccion_cliente,\n            repartidorId: repartidorId,\n            pizzas: { connect, disconnect }\n        }\n    })\n\n    revalidatePath('/pedidos')\n    return { success: 'Operación realizada correctamente' }\n}\n\n\n\nexport async function eliminarPedido(prevState, formData) {\n    const id = Number(formData.get('id'))\n\n    await prisma.pedido.delete({\n        where: {\n            id: id\n        }\n    })\n\n    revalidatePath('/pedidos')\n    return { success: 'Operación realizada correctamente' }\n\n}\n\n// ------------------------------- PIZZAS -----------------------\n\n\nexport async function insertarPizza(formData) {\n    const nombre = formData.get('nombre')\n    const precio = Number(formData.get('precio'))\n    const imagen = formData.get('imagen')\n\n\n    await prisma.pizza.create({\n        data: {\n            nombre: nombre,\n            precio: precio,\n        }\n    })\n\n    revalidatePath('/pizzas')\n    return { success: 'Éxito al realizar la operación' }\n\n}\n\n\n\nexport async function modificarPizza(formData) {\n    const id = Number(formData.get('id'))\n    const nombre = formData.get('nombre')\n    const precio = Number(formData.get('precio'))\n    const imagen = formData.get('imagen')\n    \n    await prisma.pizza.update({\n        where: {\n            id: id\n        },\n        data: {\n            nombre: nombre,\n            precio: precio,\n            imagen: imagen\n        }\n    })\n\n    revalidatePath('/pizzas')\n}\n\n\n\nexport async function eliminarPizza(formData) {\n    const id = Number(formData.get('id'))\n\n    await prisma.pizza.delete({\n        where: {\n            id: id\n        }\n    })\n\n    revalidatePath('/pizzas')\n\n}\n\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;IASsB;IAiCA;IAkCA;IAUA;IAWA;IAWA;IAYA;IAQA;IAkBA;IAuBA;IAiBA;IA+BA;IAmCA;IAiBA;IAoBA;IAsBA"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/src/components/auth/register-form.js"],"sourcesContent":["'use client'\nimport { useActionState } from 'react'\nimport { register } from '@/lib/actions'\n\n\nfunction RegisterForm({ className }) {\n\n    const [state, action, pending] = useActionState(register, {})\n\n    return (\n        <form action={action} className={className}>\n            <h1 className=\"text-3xl font-bold mb-4\">Registro</h1>\n            <div className='flex flex-col gap-4'>\n                <label>Nombre\n                    <input type='text'\n                        name='name'\n                        defaultValue={state.fields?.name || ''}\n                        placeholder=\"John Doe\"\n                        className='block w-full'\n                        required\n                    />\n                </label>\n                <label>Email\n                    <input type='email'\n                        name='email'\n                        defaultValue={state.fields?.email || ''}\n                        placeholder=\"john.doe@example.com\"\n                        className='peer block w-full'\n                    />\n                    <p className=\"invisible peer-invalid:visible text-red-300\">\n                        Por favor, introduce un email válido.\n                    </p>\n                </label>\n                <label>Password\n                    <input type=\"password\"\n                        name='password'\n                        defaultValue={state.fields?.password || ''}\n                        placeholder=\"******\"\n                        className='block w-full'\n                    />\n                </label>\n\n                <button type=\"submit\" disabled={pending} className=\"px-4 py-2 bg-blue-300 disabled:bg-slate-300 disabled:animate-pulse\" >\n                    {pending ? 'Creando cuenta...' : 'Crear cuenta'}\n                </button>\n                <p className={state?.success ? 'text-green-500' : 'hidden'}> {state.success} </p>\n                <p className={state?.error ? 'text-red-500' : 'hidden'}> {state.error} </p>\n            </div>\n\n\n        </form>\n    )\n}\n\nexport default RegisterForm"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;;AAKA,SAAS,aAAa,EAAE,SAAS,EAAE;IAE/B,MAAM,CAAC,OAAO,QAAQ,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,iBAAc,AAAD,EAAE,qHAAA,CAAA,WAAQ,EAAE,CAAC;IAE3D,qBACI,8OAAC;QAAK,QAAQ;QAAQ,WAAW;;0BAC7B,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;;4BAAM;0CACH,8OAAC;gCAAM,MAAK;gCACR,MAAK;gCACL,cAAc,MAAM,MAAM,EAAE,QAAQ;gCACpC,aAAY;gCACZ,WAAU;gCACV,QAAQ;;;;;;;;;;;;kCAGhB,8OAAC;;4BAAM;0CACH,8OAAC;gCAAM,MAAK;gCACR,MAAK;gCACL,cAAc,MAAM,MAAM,EAAE,SAAS;gCACrC,aAAY;gCACZ,WAAU;;;;;;0CAEd,8OAAC;gCAAE,WAAU;0CAA8C;;;;;;;;;;;;kCAI/D,8OAAC;;4BAAM;0CACH,8OAAC;gCAAM,MAAK;gCACR,MAAK;gCACL,cAAc,MAAM,MAAM,EAAE,YAAY;gCACxC,aAAY;gCACZ,WAAU;;;;;;;;;;;;kCAIlB,8OAAC;wBAAO,MAAK;wBAAS,UAAU;wBAAS,WAAU;kCAC9C,UAAU,sBAAsB;;;;;;kCAErC,8OAAC;wBAAE,WAAW,OAAO,UAAU,mBAAmB;;4BAAU;4BAAE,MAAM,OAAO;4BAAC;;;;;;;kCAC5E,8OAAC;wBAAE,WAAW,OAAO,QAAQ,iBAAiB;;4BAAU;4BAAE,MAAM,KAAK;4BAAC;;;;;;;;;;;;;;;;;;;AAMtF;uCAEe"}},
    {"offset": {"line": 193, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,0HAAyBC,QAAQ,CACxD,YACD,CAACC,kBAAkB","ignoreList":[0]}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/node_modules/next/src/client/app-call-server.ts"],"sourcesContent":["import { startTransition, useCallback } from 'react'\nimport {\n  ACTION_SERVER_ACTION,\n  type ReducerActions,\n  type ServerActionDispatcher,\n} from './components/router-reducer/router-reducer-types'\n\nlet globalServerActionDispatcher = null as ServerActionDispatcher | null\n\nexport function useServerActionDispatcher(\n  dispatch: React.Dispatch<ReducerActions>\n) {\n  const serverActionDispatcher: ServerActionDispatcher = useCallback(\n    (actionPayload) => {\n      startTransition(() => {\n        dispatch({\n          ...actionPayload,\n          type: ACTION_SERVER_ACTION,\n        })\n      })\n    },\n    [dispatch]\n  )\n  globalServerActionDispatcher = serverActionDispatcher\n}\n\nexport async function callServer(actionId: string, actionArgs: any[]) {\n  const actionDispatcher = globalServerActionDispatcher\n\n  if (!actionDispatcher) {\n    throw new Error('Invariant: missing action dispatcher.')\n  }\n\n  return new Promise((resolve, reject) => {\n    actionDispatcher({\n      actionId,\n      actionArgs,\n      resolve,\n      reject,\n    })\n  })\n}\n"],"names":["callServer","useServerActionDispatcher","globalServerActionDispatcher","dispatch","serverActionDispatcher","useCallback","actionPayload","startTransition","type","ACTION_SERVER_ACTION","actionId","actionArgs","actionDispatcher","Error","Promise","resolve","reject"],"mappings":";;;;;;;;;;;;;;;IA0BsBA,UAAU,EAAA;eAAVA;;IAjBNC,yBAAyB,EAAA;eAAzBA;;;uBAT6B;oCAKtC;AAEP,IAAIC,+BAA+B;AAE5B,SAASD,0BACdE,QAAwC;IAExC,MAAMC,yBAAiDC,CAAAA,GAAAA,OAAAA,WAAW,EAChE,CAACC;QACCC,CAAAA,GAAAA,OAAAA,eAAe,EAAC;YACdJ,SAAS;gBACP,GAAGG,aAAa;gBAChBE,MAAMC,oBAAAA,oBAAoB;YAC5B;QACF;IACF,GACA;QAACN;KAAS;IAEZD,+BAA+BE;AACjC;AAEO,eAAeJ,WAAWU,QAAgB,EAAEC,UAAiB;IAClE,MAAMC,mBAAmBV;IAEzB,IAAI,CAACU,kBAAkB;QACrB,MAAM,IAAIC,MAAM;IAClB;IAEA,OAAO,IAAIC,QAAQ,CAACC,SAASC;QAC3BJ,iBAAiB;YACfF;YACAC;YACAI;YACAC;QACF;IACF;AACF","ignoreList":[0]}},
    {"offset": {"line": 269, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/node_modules/next/src/client/app-find-source-map-url.ts"],"sourcesContent":["const basePath = process.env.__NEXT_ROUTER_BASEPATH || ''\nconst pathname = `${basePath}/__nextjs_source-map`\n\nexport const findSourceMapURL =\n  process.env.NODE_ENV === 'development'\n    ? function findSourceMapURL(filename: string): string | null {\n        if (filename === '') {\n          return null\n        }\n\n        if (\n          filename.startsWith(document.location.origin) &&\n          filename.includes('/_next/static')\n        ) {\n          // This is a request for a client chunk. This can only happen when\n          // using Turbopack. In this case, since we control how those source\n          // maps are generated, we can safely assume that the sourceMappingURL\n          // is relative to the filename, with an added `.map` extension. The\n          // browser can just request this file, and it gets served through the\n          // normal dev server, without the need to route this through\n          // the `/__nextjs_source-map` dev middleware.\n          return `${filename}.map`\n        }\n\n        const url = new URL(pathname, document.location.origin)\n        url.searchParams.set('filename', filename)\n\n        return url.href\n      }\n    : undefined\n"],"names":["findSourceMapURL","basePath","process","env","__NEXT_ROUTER_BASEPATH","pathname","NODE_ENV","filename","startsWith","document","location","origin","includes","url","URL","searchParams","set","href","undefined"],"mappings":";;;;+BAGaA,oBAAAA;;;eAAAA;;;AAHb,MAAMC,WAAWC,QAAQC,GAAG,CAACC,sBAAsB,MAAI;AACvD,MAAMC,WAAY,KAAEJ,WAAS;AAEtB,MAAMD,mBACXE,QAAQC,GAAG,CAACG,QAAQ,KAAK,cACrB,SAASN,iBAAiBO,QAAgB;IACxC,IAAIA,aAAa,IAAI;QACnB,OAAO;IACT;IAEA,IACEA,SAASC,UAAU,CAACC,SAASC,QAAQ,CAACC,MAAM,KAC5CJ,SAASK,QAAQ,CAAC,kBAClB;QACA,kEAAkE;QAClE,mEAAmE;QACnE,qEAAqE;QACrE,mEAAmE;QACnE,qEAAqE;QACrE,4DAA4D;QAC5D,6CAA6C;QAC7C,OAAQ,KAAEL,WAAS;IACrB;IAEA,MAAMM,MAAM,IAAIC,IAAIT,UAAUI,SAASC,QAAQ,CAACC,MAAM;IACtDE,IAAIE,YAAY,CAACC,GAAG,CAAC,YAAYT;IAEjC,OAAOM,IAAII,IAAI;AACjB,IACAC","ignoreList":[0]}},
    {"offset": {"line": 311, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 316, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-server-dom-turbopack-client-edge.ts"],"sourcesContent":["module.exports = require('../../module.compiled').vendored[\n  'react-ssr'\n].ReactServerDOMTurbopackClientEdge\n"],"names":["module","exports","require","vendored","ReactServerDOMTurbopackClientEdge"],"mappings":";AAAAA,OAAOC,OAAO,GAAGC,QAAQ,0HAAyBC,QAAQ,CACxD,YACD,CAACC,iCAAiC","ignoreList":[0]}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///home/carlos/Escritorio/Grado/SegundoDAW/EntornosServidor/segundo_trimestre/tema8_autenticacion-main/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// Since we're using the Edge build of Flight client for SSR [1], here we need to\n// also use the same Edge build to create the reference. For the client bundle,\n// we use the default and let Webpack to resolve it to the correct version.\n// 1: https://github.com/vercel/next.js/blob/16eb80b0b0be13f04a6407943664b5efd8f3d7d0/packages/next/src/server/app-render/use-flight-response.tsx#L24-L26\nexport const createServerReference = (\n  (!!process.env.NEXT_RUNTIME\n    ? // eslint-disable-next-line import/no-extraneous-dependencies\n      require('react-server-dom-webpack/client.edge')\n    : // eslint-disable-next-line import/no-extraneous-dependencies\n      require('react-server-dom-webpack/client')) as typeof import('react-server-dom-webpack/client')\n).createServerReference\n"],"names":["callServer","createServerReference","findSourceMapURL","process","env","NEXT_RUNTIME","require"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IASNC,qBAAqB,EAAA;eAArBA;;IARJC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;AAQ1B,MAAMD,wBACV,CAAA,CAAC,CAACE,QAAQC,GAAG,CAACC,YAAY,GAEvBC,QAAQ,0CAERA,QAAQ,4JAAiC,EAC7CL,qBAAqB","ignoreList":[0]}},
    {"offset": {"line": 354, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}